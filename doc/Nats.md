# Nats Streaming 詳細說明

除了NATS平台核心的特性外,NATS Streaming提供了以下一些功能特性

增强消息協議
　　NATS Streaming使用Google緩衝區實現自己的增强型消息格式 這些消息通過二进制数据流在NATS核心平台进行传播,因此不需要改变NATS的基本协议。NATS Streaming信息包含以下字段:
    　　序列 - 一个全局顺序序列号为主题的通道
    　　主题 - 是NATS Streaming 交付对象
    　　答复内容 - 对应"reply-to"对应的对象内容
    　　数据 - 真是数据内容
    　　时间戳 - 接收的时间戳，单位是纳秒
    　　重复发送 - 标志这条数据是否需要服务再次发送
    　　CRC32 - 一个循环冗余数据校验选项，在数据存储和数据通讯领域里，为了保证数据的正确性所采用的检错手段，这里使用的是 IEEE CRC32 算法

　消息/事件的持久性
　　NATS Streaming提供了可配置的消息持久化，持久目的地可以为内存或者文件。另外，对应的存储子系统使用了一个公共接口允许我们开发自己自定义实现来持久化对应的消息

　至少一次的发送
　　NATS Streaming提供了发布者和服务器之间的消息确认(发布操作) 和订阅者和服务器之间的消息确认(确认消息发送)。其中消息被保存在服务器端内存或者辅助存储(或其他外部存储器)用来为需要重新接受消息的订阅者进行重发消息。

　发布者发送速率限定
　　NATS Streaming提供了一个连接选项叫 MaxPubAcksInFlight，它能有效的限制一个发布者可能随意的在任何时候发送的未被确认的消息。当达到这个配置的最大数量时，异步发送调用接口将会被阻塞，直到未确认消息降到指定数量之下。

　每个订阅者的速率匹配／限制
　　NATS Streaming运行指定的订阅中设置一个参数为 MaxInFlight，它用来指定已确认但未消费的最大数据量，当达到这个限制时，NATS Streaming 将暂停发送消息给订阅者，直到未确认的数据量小于设定的量为止

　以主题重发的历史数据
　　新订阅的可以在已经存储起来的订阅的主题频道指定起始位置消息流。通过使用这个选项,消息就可以开始发送传递了:
    　　1. 订阅的主题存储的最早的信息
    　　2. 与当前订阅主题之前的最近存储的数据，这通常被认为是 "最后的值" 或 "初值" 对应的缓存
    　　3. 一个以纳秒为基准的 日期／时间
    　　4. 一个历史的起始位置相对当前服务的 日期／时间，例如：最后30秒
    　　5. 一个特定的消息序列号

　持久订阅
　　订阅也可以指定一个“持久化的名称”可以在客户端重启时不受影响。持久订阅会使得对应服务跟踪客户端最后确认消息的序列号和持久名称。当这个客户端重启或者重新订阅的时候，使用相同的客户端ID 和 持久化的名称，对应的服务将会从最早的未被确认的消息处恢复